<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>HSK Practice</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@2.0.2/dist/hanzi-writer.min.js"></script>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f7f7f7; }
    .container { max-width:900px; margin:40px auto; background:#fff; padding:24px; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,0.06); }
    #animationTarget { width:220px; height:220px; border:2px solid #3b82f6; background:#fff; border-radius:6px; display:flex; align-items:center; justify-content:center; }
    .lesson-btn { padding:8px 14px; border-radius:8px; background:#3b82f6; color:#fff; cursor:pointer; }
    .lesson-btn.active { background:#1e40af; }
    canvas#writingCanvas { border:2px solid #e5e7eb; border-radius:6px; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-2xl font-bold text-center mb-4">HSK Practice — проверка</h1>
    <div class="flex gap-2 justify-center mb-6">
      <button class="lesson-btn" data-lesson="1">Урок 1</button>
      <button class="lesson-btn" data-lesson="2">Урок 2</button>
      <button class="lesson-btn" data-lesson="3">Урок 3</button>
    </div>

    <div class="flex gap-6 items-start justify-center">
      <div>
        <div id="animationTarget"></div>
        <div class="flex gap-2 mt-3 justify-center">
          <button id="animateButton" class="lesson-btn">Анимировать</button>
        </div>
      </div>
      <div>
        <p><strong id="currentIdeogram" class="text-3xl">—</strong></p>
        <p id="pinyin" class="text-lg text-gray-600">pinyin</p>
        <p id="meaning" class="text-lg mt-2">meaning</p>
      </div>
    </div>

    <p id="message" class="mt-4 text-center text-sm text-gray-600"></p>
  </div>

  <script>
    // Minimal dataset (converted from your RTF). You can expand later.
    const hsk1Lessons = {
      1: { title: 'Приветствия', words: [ {char: '你', pinyin: 'nǐ', meaning: 'ты'}, {char: '好', pinyin: 'hǎo', meaning: 'хорошо'} ] },
      2: { title: 'Числа', words: [ {char: '一', pinyin: 'yī', meaning: 'один'}, {char: '二', pinyin: 'èr', meaning: 'два'} ] },
      3: { title: 'Местоимения', words: [ {char: '我', pinyin: 'wǒ', meaning: 'я'}, {char: '他', pinyin: 'tā', meaning: 'он'} ] }
    };

    let currentLessonId = 1;
    let currentWordIndex = 0;
    let writer = null;

    const animationTarget = document.getElementById('animationTarget');
    const currentIdeogramEl = document.getElementById('currentIdeogram');
    const pinyinEl = document.getElementById('pinyin');
    const meaningEl = document.getElementById('meaning');
    const messageEl = document.getElementById('message');

    function showMessage(text, type) {
      messageEl.textContent = text;
    }

    function setupAnimation(char) {
      // destroy previous writer if exists
      try { if (writer && writer.hide) writer.hide(); } catch(e){}
      animationTarget.innerHTML = '';
      try {
        writer = HanziWriter.create('animationTarget', char, {
          width: 220,
          height: 220,
          padding: 5,
          showOutline: true,
          strokeColor: '#1d4ed8'
        });
      } catch (e) {
        console.error('HanziWriter error', e);
        animationTarget.textContent = char;
        writer = null;
      }
    }

    function loadCurrentWord() {
      const lesson = hsk1Lessons[currentLessonId];
      if (!lesson) return;
      const word = lesson.words[currentWordIndex];
      if (!word) return;
      currentIdeogramEl.textContent = word.char;
      pinyinEl.textContent = word.pinyin || '';
      meaningEl.textContent = word.meaning || '';
      setupAnimation(word.char);
      showMessage(`Урок ${currentLessonId} — ${lesson.title}`);
    }

    document.getElementById('animateButton').addEventListener('click', () => {
      if (writer && writer.animateCharacter) {
        writer.animateCharacter();
      } else {
        showMessage('Анимация недоступна (Hanzi Writer не инициализирован)');
      }
    });

    document.querySelectorAll('.lesson-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        currentLessonId = parseInt(btn.dataset.lesson, 10);
        currentWordIndex = 0;
        document.querySelectorAll('.lesson-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        loadCurrentWord();
      });
    });

    // initialize
    document.querySelector('.lesson-btn[data-lesson="1"]').classList.add('active');
    window.addEventListener('load', () => { loadCurrentWord(); });
  </script>
</body>
</html>